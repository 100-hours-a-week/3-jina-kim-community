<!DOCTYPE html>
<html lang="kr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../../fonts/Fonts.css" />
    <link rel="stylesheet" href="WritePost.css" />
    <title>게시글 작성 페이지</title>
  </head>
  <body>
    <header>아무 말 대잔치</header>
    <hr class="horizontal-rule" />
    <main>
      <div class="writePage">
        <p class="writeHeader">게시글 작성</p>
        <div class="write-container">
          <form onsubmit="return handlePostSubmit(event)">
            <input type="hidden" id="editId" />
            <div class="form-group">
              <label for="title">제목*</label>
              <input
                type="text"
                id="title"
                placeholder="제목을 입력해주세요. (최대 26글자)"
              />
            </div>
            <div class="form-group">
              <label for="content">내용*</label>
              <textarea
                type="text"
                id="content"
                placeholder="내용을 입력해주세요."
              ></textarea>
            </div>
            <div class="helper-text">* helper text</div>
            <div class="form-group">
              <label for="img">이미지</label>
              <div class="choosefile">
                <button class="imgfile">파일 선택</button>
                <p class="ment">파일을 선택해주세요.</p>
              </div>
            </div>
            <button type="submit" id="submitButton" class="finishButton">
              완료
            </button>
          </form>
        </div>
      </div>
    </main>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const urlParams = new URLSearchParams(window.location.search);
        const editId = urlParams.get("editId");

        if (editId) {
          // ✅ 수정 모드: 기존 게시글 데이터 불러오기
          const posts = JSON.parse(localStorage.getItem("posts")) || [];
          const post = posts.find((p) => p.id == editId);

          if (post) {
            document.getElementById("editId").value = editId;
            document.getElementById("title").value = post.title;
            document.getElementById("content").value = post.content;
            document.getElementById("submitButton").textContent = "수정하기";
          }
        }

        // ✅ 게시글 저장 또는 수정
        document
          .querySelector("form")
          .addEventListener("submit", function (event) {
            event.preventDefault();

            const title = document.getElementById("title").value.trim();
            const content = document.getElementById("content").value.trim();
            const editId = document.getElementById("editId").value; // 수정 ID

            if (!title || !content) {
              alert("제목과 내용을 입력해주세요!");
              return;
            }

            let posts = JSON.parse(localStorage.getItem("posts")) || [];

            if (editId) {
              // ✅ 기존 게시글 수정
              posts = posts.map((p) =>
                p.id == editId ? { ...p, title, content } : p
              );
              alert("게시글이 수정되었습니다.");
              localStorage.setItem("posts", JSON.stringify(posts));
              window.location.href = `PostDetail.html?id=${editId}`; // 수정 후 상세 페이지 이동
            } else {
              // ✅ 새 게시글 작성
              const newPost = {
                id: new Date().getTime(),
                title,
                content,
              };
              posts.push(newPost);
              localStorage.setItem("posts", JSON.stringify(posts));
              window.location.href = "PostList.html"; // 새 글 작성 후 리스트 이동
            }
          });
      });
    </script>
  </body>
</html>
