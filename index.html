<!DOCTYPE html>
<html lang="kr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="/fonts/Fonts.css" />
    <link rel="stylesheet" type="text/css" href="index.css" />
    <title>김진아</title>
  </head>
  <body>
    <header>아무 말 대잔치</header>
    <hr class="horizontal-rule" />
    <main>
      <div class="login">
        <p class="loginHeader">로그인</p>
        <div class="login-container">
          <form onsubmit="return handleLogin(event)">
            <div class="form-group">
              <label for="email">이메일</label>
              <input type="text" id="email" placeholder="이메일을 입력하세요" />
            </div>
            <div class="helper-text"></div>
            <div class="form-group">
              <label for="password">비밀번호</label>
              <input
                type="password"
                id="password"
                placeholder="비밀번호를 입력하세요"
              />
            </div>
            <div class="helper-text"></div>
            <button type="submit" class="login-button" disabled>로그인</button>
            <button
              type="button"
              class="signup-button"
              onclick="window.location.href='src/pages/Signup.html'"
            >
              회원가입
            </button>
          </form>
        </div>
      </div>
    </main>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const emailInput = document.getElementById("email");
        const passwordInput = document.getElementById("password");
        const helperTexts = document.querySelectorAll(".helper-text");
        const loginBtn = document.querySelector(".login-button");

        let isEmailValid = false;
        let isPasswordValid = false;

        function checkValid() {
          loginBtn.disabled = !(isEmailValid && isPasswordValid);
        }

        emailInput.addEventListener("input", function () {
          const value = emailInput.value.trim();
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

          if (!value) {
            helperTexts[0].textContent = "*이메일을 입력해주세요.";
            isEmailValid = false;
          } else if (!emailRegex.test(value)) {
            helperTexts[0].textContent =
              "*올바른 이메일 주소 형식을 입력해주세요. (예:example@example.com)";
            isEmailValid = false;
          } else {
            helperTexts[0].textContent = "";
            isEmailValid = true;
          }
          checkValid();
        });

        passwordInput.addEventListener("input", function () {
          const value = passwordInput.value.trim();

          if (!value) {
            helperTexts[1].textContent = "*비밀번호를 입력해주세요.";
            isPasswordValid = false;
          } else if (
            value.length < 8 ||
            value.length > 20 ||
            !/[A-Z]/.test(value) ||
            !/[a-z]/.test(value) ||
            !/[0-9]/.test(value) ||
            !/[^A-Za-z0-9]/.test(value)
          ) {
            helperTexts[1].textContent =
              "*비밀번호는 8자 이상, 20자 이하이며, 대문자, 소문자, 숫자, 특수문자를 각각 최소 1개 포함해야 합니다.";
            isPasswordValid = false;
          } else {
            helperTexts[1].textContent = "";
            isPasswordValid = true;
          }
          checkValid();
        });
      });

      function handleLogin(event) {
        event.preventDefault();

        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();

        const users = JSON.parse(localStorage.getItem("users")) || [];

        const foundUser = users.find(
          (user) => user.email === email && user.password === password
        );

        if (foundUser) {
          // ✅ 로그인 성공 시 `currentUser` 저장
          localStorage.setItem("currentUser", JSON.stringify(foundUser));

          alert(`${foundUser.nickname}님, 로그인 성공!`);
          window.location.href = "src/pages/PostList.html"; // 로그인 후 이동
        } else {
          alert("아이디 또는 비밀번호를 확인해주세요.");
        }
      }
    </script>
  </body>
</html>
